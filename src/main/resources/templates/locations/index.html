<!DOCTYPE html>
<html lang="en" 
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layouts/main_layout}">
    <head>
        <title>Locations List</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <div layout:fragment="breadcrumb">
            <div class="col-sm-6">
                <h1>User Locations</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active">Locations</li>
                </ol>
            </div>
        </div> 
        <div layout:fragment="content" >
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Locations List</h3>
		            <!-- Only show Add button for ADMIN and CREATOR roles -->
		            <a sec:authorize="hasAnyAuthority('ROLE_ADMIN', 'ROLE_CREATOR')" 
		               class="btn btn-success float-sm-right mb-2 btn-sm" 
		               th:href="@{/locations/create}">
		               <span class="fa fa-plus"></span> Add Location
		            </a>
                </div>
                <div class="card-body">
                    <table id="locations_table" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Location Name</th>
                                <th sec:authorize="hasAnyAuthority('ROLE_ADMIN', 'ROLE_EDITOR')">Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        
        <div layout:fragment="page_specific_scripts">
		    <script th:inline="javascript">
		        var url = '/locations/index/data-for-datatable';
		        
		        // Get permissions from server-side evaluation
		        var hasEditPermission = /*[[${#authorization.expression('hasAnyAuthority("ROLE_ADMIN", "ROLE_EDITOR")')}]]*/ false;
		        var hasDeletePermission = /*[[${#authorization.expression('hasAuthority("ROLE_ADMIN")')}]]*/ false;
		        
		        $(document).ready(function () {
		            var columns = [
		                { "data": "id" },
		                { "data": "locationName" }
		            ];
		            
		            // Only add the actions column if user has proper permissions
		            if (hasEditPermission) {
		                columns.push({
		                    "render": function (data, type, row, meta) {
		                        var actions = '';
		                        
		                        // Add update button
		                        actions += '<a class="btn btn-info btn-xs" href="/locations/update/' + row.id + '">Update</a> ';
		                        
		                        // Add delete button only for admins
		                        if (hasDeletePermission) {
		                            actions += '<form class="datatable_inline_delete" action="/locations/delete/' + row.id + '" method="POST">' +
		                                '<button class="btn btn-danger btn-xs right" type="submit" onClick="return confirm(\'Are you sure you want to delete this location?\')">Delete</button>' +
		                                '</form>';
		                        }
		                        
		                        return actions;
		                    },
		                    "width": "20%", 
		                    "className": "text-center"
		                });
		            }
		            
		            $('#locations_table').DataTable({
		                "ajax": url,
		                "processing": true,
		                "serverSide": true,
		                "columns": columns,
		                "columnDefs": [{
		                    "targets": 1,
		                    "orderable": false
		                }]
		            });
		        });
		    </script>
		</div>

        <!--  div layout:fragment="page_specific_scripts">
            <script th:inline="javascript">
                var url = '/locations/index/data-for-datatable';
                $(document).ready(function () {
                    $('#locations_table').DataTable({
                        "ajax": url,
                        "processing": true,
                        "serverSide": true,
                        "columns": [
                            {
                                "data": "id",
                            },
                            {
                                "data": "locationName",
                            },
                            {
                                "render": function (data, type, row, meta) {
                                    return '<a class="btn btn-info btn-xs" href="/locations/update/' + row.id + '">Update</a> ' +
                                            '<form class="datatable_inline_delete" action="/locations/delete/' + row.id + '" method="POST">' +
                                            "<button class=\"btn btn-danger btn-xs right\" type=\"submit\" onClick=\"return confirm('Are you sure you want to delete this category?')\">Delete</button></form>";
                                },
                                "width": "20%", "className":"text-center",
                            }
                        ],
                        "columnDefs": [{
                                "targets": 1,
                                "orderable": false
                            }]
                    });
                });
            </script>
        </div-->
    </body>
</html>
